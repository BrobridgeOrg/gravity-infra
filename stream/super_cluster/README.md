# NATS/JetStream Super-Cluster

## Start Super-Cluster
```
goreman start
```

## Define Context
### Data Center-1 & Data Center-3
```
nats context save dc1 --server "nats://localhost:4223"
nats context save dc3 --server "nats://localhost:4223"
```
### Data Center System
```
nats context save dc1-sys \
--server "nats://localhost:4223" \
--user admin \
--password pass
```

## Verify
### Server List
```
nats --context dc1-sys server list
```
```
╭────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                  Server Overview                                                   │
├──────┬─────────┬──────┬─────────┬─────┬───────┬──────┬────────┬─────┬────────┬───────┬───────┬──────┬────────┬─────┤
│ Name │ Cluster │ Host │ Version │ JS  │ Conns │ Subs │ Routes │ GWs │ Mem    │ CPU % │ Cores │ Slow │ Uptime │ RTT │
├──────┼─────────┼──────┼─────────┼─────┼───────┼──────┼────────┼─────┼────────┼───────┼───────┼──────┼────────┼─────┤
│ n2   │ dc2     │ 0    │ 2.9.15  │ yes │ 1     │ 51   │ 0      │ 2   │ 18 MiB │ 0     │ 10    │ 0    │ 15m55s │ 1ms │
│ n1   │ dc1     │ 0    │ 2.9.15  │ yes │ 0     │ 59   │ 0      │ 2   │ 19 MiB │ 0     │ 10    │ 0    │ 15m55s │ 1ms │
│ n3   │ dc3     │ 0    │ 2.9.15  │ yes │ 0     │ 50   │ 0      │ 2   │ 18 MiB │ 0     │ 10    │ 0    │ 15m55s │ 1ms │
├──────┼─────────┼──────┼─────────┼─────┼───────┼──────┼────────┼─────┼────────┼───────┼───────┼──────┼────────┼─────┤
│      │ 3       │ 3    │         │ 3   │ 1     │ 160  │        │     │ 55 MiB │       │       │ 0    │        │     │
╰──────┴─────────┴──────┴─────────┴─────┴───────┴──────┴────────┴─────┴────────┴───────┴───────┴──────┴────────┴─────╯

╭────────────────────────────────────────────────────────────────────────────╮
│                              Cluster Overview                              │
├─────────┬────────────┬───────────────────┬───────────────────┬─────────────┤
│ Cluster │ Node Count │ Outgoing Gateways │ Incoming Gateways │ Connections │
├─────────┼────────────┼───────────────────┼───────────────────┼─────────────┤
│ dc3     │ 1          │ 2                 │ 2                 │ 0           │
│ dc1     │ 1          │ 2                 │ 2                 │ 0           │
│ dc2     │ 1          │ 2                 │ 2                 │ 1           │
├─────────┼────────────┼───────────────────┼───────────────────┼─────────────┤
│         │ 3          │ 6                 │ 6                 │ 1           │
╰─────────┴────────────┴───────────────────┴───────────────────┴─────────────╯
```

### JetStream List
```
nats --context dc1-sys server report jetstream
```

```
╭───────────────────────────────────────────────────────────────────────────────────────────────╮
│                                       JetStream Summary                                       │
├────────┬─────────┬─────────┬───────────┬──────────┬───────┬────────┬──────┬─────────┬─────────┤
│ Server │ Cluster │ Streams │ Consumers │ Messages │ Bytes │ Memory │ File │ API Req │ API Err │
├────────┼─────────┼─────────┼───────────┼──────────┼───────┼────────┼──────┼─────────┼─────────┤
│ n1*    │ dc1     │ 0       │ 0         │ 0        │ 0 B   │ 0 B    │ 0 B  │ 0       │ 0       │
│ n2     │ dc2     │ 0       │ 0         │ 0        │ 0 B   │ 0 B    │ 0 B  │ 0       │ 0       │
│ n3     │ dc3     │ 0       │ 0         │ 0        │ 0 B   │ 0 B    │ 0 B  │ 0       │ 0       │
├────────┼─────────┼─────────┼───────────┼──────────┼───────┼────────┼──────┼─────────┼─────────┤
│        │         │ 0       │ 0         │ 0        │ 0 B   │ 0 B    │ 0 B  │ 0       │ 0       │
╰────────┴─────────┴─────────┴───────────┴──────────┴───────┴────────┴──────┴─────────┴─────────╯

╭────────────────────────────────────────────────────────────╮
│                RAFT Meta Group Information                 │
├──────┬──────────┬────────┬─────────┬────────┬────────┬─────┤
│ Name │ ID       │ Leader │ Current │ Online │ Active │ Lag │
├──────┼──────────┼────────┼─────────┼────────┼────────┼─────┤
│ n1   │ fjFyEjc1 │ yes    │ true    │ true   │ 0.00s  │ 0   │
│ n2   │ 44jzkV9D │        │ true    │ true   │ 0.92s  │ 0   │
│ n3   │ BXScrY9i │        │ true    │ true   │ 0.92s  │ 0   │
╰──────┴──────────┴────────┴─────────┴────────┴────────┴─────╯
```

## Function Test
### Reply Handler
```
nats --context dc1 reply 'greet' 'hello from dc1'
```

### Request
```
nats --context dc3 request 'greet' ''
```

